{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block navbar_links %}
<li class="nav-item">
    <a class="nav-link" href="/admin_users">Users</a>
  </li>
 <li class="nav-item">
    <a class="nav-link" href="/logout">Logout</a>
  </li>
  <li class="nav-item">
  <a class="nav-link" href="/admin/dashboard/summary">Summary</a>
</li>

  
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h2 class="mb-4">Admin Dashboard</h2>

    <h2 class="mb-3">All Parking Lots</h2>
    <a href="/admin/add_lot" class="btn btn-success mb-3">+ Add New Lot</a>

    <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Name</th>
                    <th>Location</th>
                    <th>Price/hr</th>
                    <th>Spots(A/O)</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
            {% for lot in parking_lots %}
            <tr>
                <td>{{ lot.name }}</td>
                <td>{{ lot.location }}</td>
                <td>{{ lot.price }}</td>
                <td>
                    {{ lot.spots | selectattr("status", "equalto", "A") | list | length }} Available / 
                    {{ lot.spots | selectattr("status", "equalto", "O") | list | length }} Occupied
                </td>
                <td>
                    <a href="/edit_lot/{{ lot.id }}" class="btn btn-warning btn-sm">Edit</a>
                    <a href="/delete_lot/{{ lot.id }}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this lot?');">Delete</a>
                 <a href="/view_spots/{{ lot.id }}" class="btn btn-info btn-sm">View Spots</a>


                </td>
            </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    

    {% if parking_spots %}
<h3 class="mt-5">Parking Spots for Lot: {{ selected_lot.name }}</h3>
<div class="table-responsive">
    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Status</th>
                <th>Username</th>
                
            </tr>
        </thead>
        <tbody>
            {% for spot in parking_spots %}
            <tr>
                <td>{{ spot.spot_number}}</td>
                <td>{{ spot.status }}</td>
                <td>
                    {% if spot.user %}
                        {{ spot.user.username }}
                        

                    {% else %}
                        -
                    {% endif %}
                </td>
                
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

{% endblock %}
